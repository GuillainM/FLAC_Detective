============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-7.4.4, pluggy-1.6.0 -- C:\Users\loutr\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\loutr\Dropbox\Perso\Flac_Detective
configfile: pyproject.toml
plugins: anyio-4.11.0, cov-4.1.0, mock-3.15.1
collecting ... collected 13 items

tests/test_quality.py::TestQualityAnalysis::test_detect_clipping_no_clipping PASSED [  7%]
tests/test_quality.py::TestQualityAnalysis::test_detect_clipping_with_clipping PASSED [ 15%]
tests/test_quality.py::TestQualityAnalysis::test_detect_clipping_light FAILED [ 23%]
tests/test_quality.py::TestQualityAnalysis::test_detect_clipping_stereo PASSED [ 30%]
tests/test_quality.py::TestQualityAnalysis::test_detect_dc_offset_no_offset PASSED [ 38%]
tests/test_quality.py::TestQualityAnalysis::test_detect_dc_offset_with_offset PASSED [ 46%]
tests/test_quality.py::TestQualityAnalysis::test_detect_dc_offset_stereo FAILED [ 53%]
tests/test_quality.py::TestQualityAnalysis::test_detect_corruption_valid_file PASSED [ 61%]
tests/test_quality.py::TestQualityAnalysis::test_detect_corruption_read_error PASSED [ 69%]
tests/test_quality.py::TestQualityAnalysis::test_detect_corruption_empty_file PASSED [ 76%]
tests/test_quality.py::TestQualityAnalysis::test_detect_corruption_nan_values PASSED [ 84%]
tests/test_quality.py::TestQualityAnalysis::test_analyze_audio_quality_complete PASSED [ 92%]
tests/test_quality.py::TestQualityAnalysis::test_analyze_audio_quality_corrupted_file PASSED [100%]

================================== FAILURES ===================================
_______________ TestQualityAnalysis.test_detect_clipping_light ________________

self = <test_quality.TestQualityAnalysis object at 0x000002843E2BDE00>

    def test_detect_clipping_light(self):
        """VÚrifie la dÚtection de clipping lÚger."""
        data = np.random.rand(44100) * 0.5
        # Ajouter quelques pics
        data[100:105] = 0.995
        result = detect_clipping(data)
    
>       assert result["has_clipping"] is False  # < 0.01%
E       assert True is False

data       = array([0.03292417, 0.42131633, 0.20549778, ..., 0.48336572, 0.22820955,
       0.25959681], shape=(44100,))
result     = {'clipped_samples': 5, 'clipping_percentage': 0.0113, 'has_clipping': True, 'severity': 'moderate'}
self       = <test_quality.TestQualityAnalysis object at 0x000002843E2BDE00>

tests\test_quality.py:49: AssertionError
______________ TestQualityAnalysis.test_detect_dc_offset_stereo _______________

self = <test_quality.TestQualityAnalysis object at 0x000002843E319370>

    def test_detect_dc_offset_stereo(self):
        """VÚrifie la dÚtection sur signal stÚrÚo."""
        # Signal stÚrÚo avec offset
        data = np.ones((44100, 2)) * 0.05
        result = detect_dc_offset(data)
    
        assert result["has_dc_offset"] is True
>       assert result["severity"] == "severe"
E       AssertionError: assert 'moderate' == 'severe'
E         - severe
E         + moderate

data       = array([[0.05, 0.05],
       [0.05, 0.05],
       [0.05, 0.05],
       ...,
       [0.05, 0.05],
       [0.05, 0.05],
       [0.05, 0.05]], shape=(44100, 2))
result     = {'dc_offset_value': 0.05, 'has_dc_offset': True, 'severity': 'moderate'}
self       = <test_quality.TestQualityAnalysis object at 0x000002843E319370>

tests\test_quality.py:88: AssertionError

---------- coverage: platform win32, python 3.13.7-final-0 -----------
Name                                            Stmts   Miss Branch BrPart   Cover   Missing
--------------------------------------------------------------------------------------------
src\flac_detective\__init__.py                      5      0      0      0 100.00%
src\flac_detective\analysis\__init__.py             2      0      0      0 100.00%
src\flac_detective\analysis\analyzer.py            22     11      0      0  50.00%   24, 36-78
src\flac_detective\analysis\metadata.py            33     25      2      0  22.86%   22-37, 53-90
src\flac_detective\analysis\quality.py             61      6     22      2  90.36%   43, 87, 197-205
src\flac_detective\analysis\scoring.py             67     59     32      0   8.08%   38-77, 94-111, 125-134, 149-160
src\flac_detective\analysis\spectrum.py            84     72     24      0  11.11%   31-92, 111-168, 183-197
src\flac_detective\analyzer.py                      2      2      0      0   0.00%   6-8
src\flac_detective\config.py                       33      0      0      0 100.00%
src\flac_detective\main.py                        126    126     36      0   0.00%   13-238
src\flac_detective\repair.py                        3      3      0      0   0.00%   6-9
src\flac_detective\repair\__init__.py               2      2      0      0   0.00%   7-9
src\flac_detective\repair\__main__.py              34     34     12      0   0.00%   3-76
src\flac_detective\repair\encoding.py              22     22      4      0   0.00%   3-74
src\flac_detective\repair\fixer.py                112    112     20      0   0.00%   3-229
src\flac_detective\repair\metadata.py              49     49     14      0   0.00%   3-108
src\flac_detective\reporter.py                      2      2      0      0   0.00%   6-8
src\flac_detective\reporting\__init__.py            3      0      0      0 100.00%
src\flac_detective\reporting\reporter.py          139    123     20      0  10.06%   31-35, 45-55, 64-96, 106-178, 187-276
src\flac_detective\reporting\statistics.py         17     14      2      0  15.79%   15-47, 83
src\flac_detective\reporting\styles.py             13      5      4      0  47.06%   50-55
src\flac_detective\reporting\text_reporter.py     100     86     34      0  10.45%   18, 29-31, 42, 54-64, 75-82, 93-100, 109-223
src\flac_detective\tracker.py                      39     24      4      0  34.88%   21-24, 32-39, 50-55, 66, 74-76, 84, 92, 100
src\flac_detective\utils.py                        10      4      0      0  60.00%   38-41
--------------------------------------------------------------------------------------------
TOTAL                                             980    781    230      2  18.10%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests/test_quality.py::TestQualityAnalysis::test_detect_clipping_light
FAILED tests/test_quality.py::TestQualityAnalysis::test_detect_dc_offset_stereo
======================== 2 failed, 11 passed in 12.76s ========================
